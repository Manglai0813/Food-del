# 10-コード品質チェックリスト

> 日常開発で実施すべきコード品質チェック項目

## ⚡ クイックスタート

```bash
# 全チェック実行
npm run lint && npm run type-check && npm run test

# 自動修復
npm run lint:fix

# ホットリロード開発
npm run dev
```

---

## 📋 Pull Request 作成前チェックリスト

### 必須チェック項目

```markdown
- [ ] ESLintエラーが0個である (npm run lint)
- [ ] TypeScriptコンパイルエラーが0個である (npm run type-check)
- [ ] テストがすべてパスしている (npm run test)
- [ ] ブランチ名がコンベンション準拠している (feat/xxx, fix/xxx)
- [ ] コミットメッセージが日本語で明確である
```

### コード品質チェック

```markdown
- [ ] any型を使っていない
- [ ] unused変数がない
- [ ] console.logを本番コードに含めていない
- [ ] Magic numberやstring literalが定数化されている
- [ ] エラーハンドリングが適切に実装されている
```

### コンポーネント別チェック

```markdown
### React コンポーネント
- [ ] Props型が定義されている
- [ ] React.FC<Props>で型指定している
- [ ] Hook依存が正しく設定されている (dependencies)
- [ ] 不要なre-renderが発生していない

### ページコンポーネント
- [ ] ローディング状態が実装されている
- [ ] エラー状態が実装されている
- [ ] 空状態が実装されている
- [ ] レスポンシブデザインに対応している

### API統合
- [ ] TanStack Query (useQuery/useMutation) を使用している
- [ ] キャッシュキーが正しく設定されている
- [ ] エラーハンドリングが実装されている
- [ ] ローディング状態が正しく表示される
```

### ドキュメンテーション

```markdown
- [ ] 新機能の場合、ドキュメントを更新した
- [ ] 複雑なロジックの場合、コメントを追加した
- [ ] 重要な決定の場合、実装理由を記録した
```

---

## 🔍 開発中のコード品質チェック

### 1時間ごとのチェック

```bash
# ESLintチェック
npm run lint

# 修復可能な問題を自動修正
npm run lint:fix
```

### コミット前のチェック

```bash
# Husky pre-commit hook で自動実行
# （自動実行されない場合は手動実行）
npm run lint:fix
npm run type-check
```

### PR作成時のチェック

```bash
# 全テスト実行
npm run test

# ビルドが成功するか確認
npm run build

# 本番環境での動作確認
npm run preview
```

---

## 🐛 よくあるエラーと解決策

### エラー1: `Unexpected any. Specify a different type`

**原因**: `any` 型を使用している

**解決**:
```typescript
// ❌ 使用禁止
const data: any = response;

// ✅ 解決方法
const data: unknown = response;
const data: Record<string, unknown> = response;
const data: ApiResponse<User> = response;
```

**参照**: [09-コード品質改善ガイド](./09-コード品質改善ガイド.md#型安全性の改善)

---

### エラー2: `Fast refresh only works when a file only exports components`

**原因**: ファイルがコンポーネントと定数を混在導出している

**解決**:
```typescript
// ❌ 問題のパターン
const variants = cva(/* ... */);
export function Component() { /* ... */ }
export { variants };

// ✅ 解決: 定数を別ファイルに分離
// variants.ts
export const variants = cva(/* ... */);

// component.tsx
import { variants } from './variants';
export function Component() { /* ... */ }
```

**参照**: [09-コード品質改善ガイド](./09-コード品質改善ガイド.md#コンポーネントの分離)

---

### エラー3: `The ... conditional could make the dependencies of useMemo Hook change`

**原因**: Hook外で条件判定を行っている

**解決**:
```typescript
// ❌ 警告が発生
const data = condition ? value1 : value2;
const memoized = useMemo(() => process(data), [data]);

// ✅ 解決: Hook内に条件判定を移動
const memoized = useMemo(() => {
  const data = condition ? value1 : value2;
  return process(data);
}, [condition, value1, value2]);
```

**参照**: [09-コード品質改善ガイド](./09-コード品質改善ガイド.md#hook依存の最適化)

---

### エラー4: `'variable' is assigned a value but never used`

**原因**: 未使用の変数がある

**解決**:
```typescript
// ❌ 未使用
const unused = getValue();

// ✅ 解決方法1: 削除
// （不要な変数は削除）

// ✅ 解決方法2: 使用する
const unused = getValue();
console.log(unused);

// ✅ 解決方法3: 意図的に無視
const _unused = getValue();  // _ プレフィックス
```

---

## 📊 品質メトリクス目標値

| メトリクス | 目標値 | 現状 |
|----------|--------|------|
| ESLintスコア | 100% | ✅ 100% |
| TypeScript型カバレッジ | 100% | ✅ 100% |
| テストカバレッジ | 80% 以上 | 監視中 |
| 本番バンドルサイズ | < 500KB | 監視中 |
| Lighthouse スコア | 90+ | 監視中 |

---

## 🛠 自動修復コマンド

```bash
# ESLint 自動修復
npm run lint:fix

# Prettier コード整形
npm run format

# 両方実行
npm run lint:fix && npm run format

# TypeScript 型チェック（修復不可）
npm run type-check

# 全チェック実行
npm run lint && npm run type-check && npm run test
```

---

## 📚 参考ドキュメント

- [09-コード品質改善ガイド](./09-コード品質改善ガイド.md) - 詳細な実装ガイド
- [03-開発ガイド](./03-開発ガイド.md) - コーディング規約
- [05-コンポーネント設計](./05-コンポーネント設計.md) - コンポーネント設計パターン
- [07-状態管理とキャッシング](./07-状態管理とキャッシング.md) - Hook と TanStack Query

---

## 🔗 外部リンク

- [ESLint 公式ドキュメント](https://eslint.org/)
- [TypeScript ハンドブック](https://www.typescriptlang.org/docs/)
- [React フック](https://react.dev/reference/react)

---

## 🎯 定期的な品質監視

### 毎日
- [ ] コミット前に ESLint チェック実行

### 毎週
- [ ] 全テストスイート実行
- [ ] ビルドサイズ確認
- [ ] Lighthouse スコア確認

### 毎月
- [ ] 依存関係の脆弱性スキャン
- [ ] パフォーマンス分析
- [ ] セキュリティレビュー

---

**最終更新**: 2025-10-23
**バージョン**: 1.0.0
