# 型システム定義

## 概要
本プロジェクトのTypeScript型システムは、バックエンドAPIと完全に同期された型安全なフロントエンド開発を実現します。

## 型定義ファイル構造

### `/src/types/api.ts` - API共通型
```typescript
// 基本APIレスポンス形式
export interface ApiResponse<T = any> {
  success: boolean;
  message: string;
  data?: T;
  errors?: string[];
}

// ページネーションレスポンス形式
export interface PaginatedResponse<T> extends ApiResponse<T[]> {
  pagination: {
    page: number;
    limit: number;
    total: number;
    totalPages: number;
    hasNext: boolean;
    hasPrev: boolean;
  };
}
```

### `/src/types/auth.ts` - 認証関連型
```typescript
// ユーザー基本情報
export interface User {
  id: string;
  email: string;
  firstName: string;
  lastName: string;
  phone?: string;
  imageUrl?: string;
  role: 'customer' | 'admin';
  isVerified: boolean;
  createdAt: string;
  updatedAt: string;
}

// 認証レスポンス
export interface AuthResponse {
  user: User;
  accessToken: string;
  refreshToken: string;
}
```

### `/src/types/food.ts` - 食品関連型
```typescript
// 食品基本情報
export interface Food {
  id: string;
  name: string;
  description: string;
  price: number;
  imageUrl: string;
  categoryId: string;
  category?: {
    id: string;
    name: string;
  };
  isAvailable: boolean;
  tags: string[];
  nutritionInfo?: NutritionInfo;
  allergens: string[];
  preparationTime: number;
  inventory: {
    stock: number;
    reserved: number;
    available: number;
    minStock: number;
    maxStock: number;
    reorderLevel: number;
    version: number; // オプティミスティックロック用
  };
  createdAt: string;
  updatedAt: string;
}
```

### `/src/types/cart.ts` - カート関連型
```typescript
// カートアイテム
export interface CartItem {
  id: string;
  userId: string;
  foodId: string;
  food: Food;
  quantity: number;
  specialInstructions?: string;
  addedAt: string;
  updatedAt: string;
}

// カート概要
export interface CartSummary {
  items: CartItem[];
  totalItems: number;
  subtotal: number;
  tax: number;
  deliveryFee: number;
  total: number;
}
```

### `/src/types/order.ts` - 注文関連型
```typescript
// 注文ステータス
export type OrderStatus =
  | 'pending'
  | 'confirmed'
  | 'preparing'
  | 'ready'
  | 'out_for_delivery'
  | 'delivered'
  | 'cancelled'
  | 'failed';

// 注文基本情報
export interface Order {
  id: string;
  userId: string;
  orderNumber: string;
  status: OrderStatus;
  items: OrderItem[];
  subtotal: number;
  tax: number;
  deliveryFee: number;
  total: number;
  paymentMethod: PaymentMethod;
  deliveryType: DeliveryType;
  deliveryAddress?: DeliveryAddress;
  specialInstructions?: string;
  estimatedDeliveryTime?: string;
  actualDeliveryTime?: string;
  statusHistory: OrderStatusHistory[];
  createdAt: string;
  updatedAt: string;
}
```

### `/src/types/category.ts` - カテゴリ関連型
```typescript
// カテゴリ基本情報
export interface Category {
  id: string;
  name: string;
  description?: string;
  imageUrl?: string;
  isActive: boolean;
  sortOrder: number;
  parentId?: string;
  parent?: Category;
  children: Category[];
  foods: Food[];
  _count: {
    foods: number;
    children: number;
  };
  createdAt: string;
  updatedAt: string;
}
```

## 型安全性保証機能

### 1. APIエンドポイント型定義
```typescript
export interface ApiEndpoints {
  'POST /api/auth/login': {
    request: LoginRequest;
    response: AuthResponse;
  };
  'GET /api/foods': {
    response: PaginatedResponse<Food>;
  };
  'POST /api/cart/items': {
    request: AddToCartRequest;
    response: ApiResponse<CartItem>;
  };
}
```

### 2. リクエスト・レスポンス型
```typescript
// 型安全なAPI呼び出し
type RequestData<T extends keyof ApiEndpoints> =
  ApiEndpoints[T] extends { request: infer R } ? R : never;

type ResponseData<T extends keyof ApiEndpoints> =
  ApiEndpoints[T] extends { response: infer R } ? R : never;
```

### 3. フォームバリデーション型
```typescript
import { z } from 'zod';

// 登録フォームスキーマ
export const registerSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8),
  firstName: z.string().min(1),
  lastName: z.string().min(1),
  phone: z.string().optional(),
});

export type RegisterFormData = z.infer<typeof registerSchema>;
```

## 型同期戦略

### 1. 人工同期アプローチ
- バックエンド型定義の手動複製
- 定期的な一貫性チェック
- 型変更時の明示的な更新

### 2. 型整合性検証
```typescript
// 型互換性テスト
type TypeCompat<T, U> = T extends U ? (U extends T ? true : false) : false;

// バックエンドとの互換性確認
type AuthCompatible = TypeCompat<BackendUser, FrontendUser>;
```

### 3. 型エラー防止
- **Strict TypeScript設定**: 厳格な型チェック
- **ESLint TypeScript Rules**: コード品質保証
- **型ガード関数**: 実行時型チェック

## ユーティリティ型

### 1. 共通パラメータ型
```typescript
export interface PaginationParams {
  page?: number;
  limit?: number;
}

export interface SortParams<T extends string = string> {
  sortBy?: T;
  sortOrder?: 'asc' | 'desc';
}

export interface SearchParams {
  search?: string;
}
```

### 2. 条件型とマップ型
```typescript
// オプショナル型変換
type Partial<T> = {
  [P in keyof T]?: T[P];
};

// 必須型変換
type Required<T> = {
  [P in keyof T]-?: T[P];
};
```

## 型定義のベストプラクティス

### 1. 命名規則
- **Interface**: PascalCase (例: `UserProfile`)
- **Type Alias**: PascalCase (例: `OrderStatus`)
- **Generic**: 単一大文字 (例: `T`, `U`)

### 2. エクスポート戦略
- **Named Export**: 具体的な型
- **Type-only Export**: 型のみのエクスポート
- **Re-export**: 関連型のグループ化

### 3. 型拡張パターン
```typescript
// 基底型の拡張
interface BaseEntity {
  id: string;
  createdAt: string;
  updatedAt: string;
}

interface User extends BaseEntity {
  email: string;
  firstName: string;
  lastName: string;
}
```

## 型チェック設定

### tsconfig.json
```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "noImplicitReturns": true,
    "noImplicitThis": true
  }
}
```