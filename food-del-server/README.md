# Food-Del-Server

**現代的な技術スタックで構築された、堅牢で高性能なフードデリバリーアプリケーション向けバックエンドAPI。**

このプロジェクトは、単なる機能実装に留まらず、生産環境での運用を想定したスケーラビリティ、保守性、およびセキュリティを重視した設計思想を体現しています。TypeScriptによる完全な型安全性を確保し、Bunランタイムによる高速な実行環境を基盤としています。

---

## 🌟 技術的ハイライト (Technical Highlights)

このプロジェクトは、現代的なバックエンド開発における複数のベストプラクティスを実装しています。

#### 1. 階層型アーキテクチャ (Layered Architecture)
-   **関心の分離**: `Routes` -> `Middleware` -> `Controllers` -> `Services` の明確な階層構造を採用。各レイヤーは単一の責務を持ち、コードの可読性と保守性を最大化しています。
-   **Thin Controller, Fat Service**: コントローラーはHTTPリクエストの調整役に徹し、すべてのコアビジネスロジックは再利用可能でテストが容易なサービス層に集約されています。

#### 2. 高度な並行処理制御 (Advanced Concurrency Control)
-   **楽観的ロック**: 在庫の手動更新など、競合の可能性が低い操作には、`version`フィールドを用いた楽観的ロックを採用し、パフォーマンスを維持しつつデータ整合性を保証します。
-   **悲観的ロック**: ユーザーによる在庫の予約など、競合が頻発する可能性のある操作には、データベースの行レベルロック（`FOR UPDATE`）を用いた悲観的ロックを採用し、オーバーセリングを確実に防止します。

#### 3. データベーストランザクション管理 (Transaction Management)
-   注文作成やキャンセルなど、複数のテーブルにまたがる複雑な操作は、すべて`Prisma`の`$transaction`機能でラップされています。これにより、プロセス全体がアトミック（All or Nothing）であることが保証され、いかなる状況でもデータの一貫性が保たれます。

#### 4. エンドツーエンドの型安全性 (End-to-End Type Safety)
-   `Zod`によるAPI入力の厳格なバリデーションから、`Prisma`によるデータベースアクセスの完全な型補完まで、データがシステムを通過するすべての段階でTypeScriptによる型安全性が徹底されています。

## ✨ 主要機能 (Key Features)

-   **認証・認可**: JWT (Access/Refresh Token) 方式による安全な認証と、役割ベース（管理者/顧客）のアクセス制御。
-   **商品・カテゴリ管理**: 在庫管理を含む、完全な商品ライフサイクル管理機能。
-   **ショッピングカート**: データベースと連携した永続的なカート機能。
-   **注文システム**: トランザクションに対応した堅牢な注文作成・管理・履歴追跡機能。
-   **ファイル管理**: 画像アップロードと、権限に基づいたセキュアな静的ファイル提供。

## 🛠️ 技術スタック (Tech Stack)

-   **ランタイム**: Bun
-   **フレームワーク**: Express.js
-   **言語**: TypeScript
-   **ORM**: Prisma
-   **データベース**: PostgreSQL
-   **バリデーション**: Zod

## 📚 詳細ドキュメント

より詳細なアーキテクチャ分析、デプロイメントガイド、およびデバッグの記録については、以下のディレクトリを参照してください。

-   `./notes/`: プロジェクトの内部構造、各モジュールの詳細な分析。
-   `./deploy_docs/`: 本番環境へのデプロイと、その過程で発生した問題のデバッグに関する実践的なガイド。

## 🚀 実行方法 (Running the Project)

このプロジェクトはDocker Composeを使用して簡単に起動できます。詳細な手順は `deploy_docs/15_Docker_Compose活用編_複数サービス連携.md` を参照してください。

1.  **環境変数の設定**: プロジェクトルートの`.env`ファイルを編集します。
2.  **起動**: プロジェクトルートで以下のコマンドを実行します。
    ```bash
    docker-compose up --build -d
    ```
3.  **データベースマイグレーション**: 別のターミナルで以下のコマンドを実行します。
    ```bash
    docker-compose exec server bunx prisma migrate dev
    ```

---
